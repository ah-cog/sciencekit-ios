<!DOCTYPE html>
<html>
  <head>
    <title>ScienceKit</title>

    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" charset="utf-8">

    //
    // Open browser to authorize app using OAuth2.
    //

    function openInAppBrowser() {

        //var uri = localStorage['host'] + "/dialog/authorize?client_id=client123&client_secret=ssh-secret&response_type=code&redirect_uri=/oauth/exchange";
        localStorage['host'] = "http://192.168.1.144:3000";
        localStorage['client_id'] = "client123";
        localStorage['client_secret'] = "ssh-secret";

        var uri = localStorage['host'] + "/dialog/authorize?client_id=" + localStorage['client_id'] + "&client_secret=" + localStorage['client_secret'] + "&response_type=code&redirect_uri=/oauth/exchange";

        console.log('Opening InAppBrowser at ' + uri);

        // Create InAppBrowser object
        var ref = window.open(uri, '_blank', 'location=yes');

        // Set up "loadstart" event listener
        ref.addEventListener('loadstart', function(event) { 
            
            console.log("InAppBrowser loaded " + event.url);
        });
        
        // // Set up "exit" event listener
        // ref.addEventListener('exit', function(event) { 
        //     console.log("InAppBrowser has closed.");

        //     // Open timeline page
        //     //$(location).attr('href', './timeline.html');

        //     exchangeGrantForAccessToken({
        //         'client_id': localStorage['client_id'],
        //         'client_secret': localStorage['client_secret'],
        //         'code': localStorage['code'],
        //         'grant_type': 'authorization_code',
        //         'redirect_uri': '/'
        //     });
        // });

        // // Set up "loadstop" event listener
        // ref.addEventListener('loadstop', function(event) {
        //     alert(event.url);
        //     if(event.url.indexOf("code=") !== -1) {

        //         var from = event.url.indexOf("code=") + 5;
        //         var to = event.url.indexOf("&", from);
        //         var code = null;
        //         if (to !== -1) {
        //             code = event.url.substring(from, to);
        //             localStorage['code'] = code;
        //         } else {
        //             code = event.url.substring(from);
        //             localStorage['code'] = code;
        //         }

        //         // Store code retreived from child browser
        //         console.log("code = " + localStorage['code']);
        //         ref.close();
        //     }
        // });

        // Set up "loaderror" event listener
        // ref.addEventListener('loaderror', function(event) { alert('error: ' + event.message); });
    }

    //
    // Wait for device API libraries to load
    //

    document.addEventListener("deviceready", onDeviceReady, false);

    //
    // Device APIs are available
    //

    function onDeviceReady() {

        openInAppBrowser();
         // var ref = window.open('http://apache.org', '_blank', 'location=yes');
         // ref.addEventListener('loadstart', function(event) { alert('start: ' + event.url); });
         // ref.addEventListener('loadstop', function(event) { alert('stop: ' + event.url); });
         // ref.addEventListener('loaderror', function(event) { alert('error: ' + event.message); });
         // ref.addEventListener('exit', function(event) { alert(event.type); });
    }

    </script>
  </head>

  <body>
  </body>

</html>