<!DOCTYPE html><html><head><title>ScienceKit</title><link rel="stylesheet" href="./css/style.css"><script src="cordova-2.6.0.js"></script><script src="childbrowser.js"></script><script src="jquery.min.js"></script><script src="socket.io.min.js"></script><script src="js/sciencekit.js"></script></head><body><!-- TODO: Remove this!--><!--h2 Exchange client's authorization grant for a client access token--><!--a(id="auth_link", href="javascript:void(0);") Authenticate ScienceKit--><!--p(id="token_response") no token received--><!--h2 Request Resource (on behalf of owner that granted authorization)--><!--a(id="account-list", href="javascript:void(0);") Request resource (using access token)--><!--p(id="resource_response") no resource received--><div id="top" style="text-align: right; font-size: 30px; padding-right: 10px; z-index: 1000;" class="edge"><!--a(a(href="javscript:void(0);", onclick="generateStory();") --><!--	img(src="./img/story-time.png", alt="story time")--><!--a(href="javascript:void(0);", onclick="scrollTickle();") --><!--	img(src="./img/search.png", alt="search") --><a href="javascript:void(0);" onclick="showHiddenFrames();"> <img src="./img/history.png" alt="show whole story"></a><a href="./timeline.html"> <img src="./img/refresh.png" alt="refresh"></a><a href="javscript:void(0);" onclick="scrollToTop();"> <img src="./img/up-arrow.png" alt="top"></a></div><!----><!-- Templates for Timeline Widgets (this is not visible)--><!----><div id="narrative-templates" class="narrative-templates"><!-- Template timeline widgets--><ul id="narrative-list-template"><li id="thought-activity-template" data-activity-type="thought" data-id="" data-timeline="" class="activity-template"><div style="display: table; width: 100%;"><div style="display: table-row;"><div style="display: table-cell; text-align: center; vertical-align: middle;"><img src="./img/blank.png" width="50" height="0" style="padding: 10px;"></div><div style="display: table-cell; position: relative; z-index: 0; width: 100%; border-left: 2px solid #f16521; vertical-align: middle; padding-left: 22px; padding-top: 40px; font-size: 20px; color: #666666;" class="account">&nbsp;</div></div><div style="display: table-row;"><div style="display: table-cell; text-align: center; vertical-align: middle;"><img src="./img/thought.png" width="50" height="50" style="padding: 10px;"></div><div style="display: table-cell; position: relative; z-index: 0; width: 100%; border-left: 2px solid #f16521;"><div class="activity-widget"><div style="display: table; width: 100%;" class="element-table"><!-- Core activity--><div style="display: table-row;" class="element"><div style="display: table-cell; min-width: 100%; vertical-align: middle;" contenteditable="true" class="text">-</div><div style="width: 150px; display: table-cell; text-align: right; vertical-align: top;" class="options"><!--img(class="open", src="./img/open.png")--><img src="./img/cross-gray.png" class="hide"></div></div><!-- Divider--><div style="display: table-row;"><div style="display: table-cell;" class="divider"><hr style="margin-bottom: 8px; height: 1px; border: none; background-color: #dddddd;"></div><div style="display: table-cell;" class="divider"><hr style="margin-bottom: 8px; height: 1px; border: none; background-color: #dddddd;"></div></div><!-- Tags--><div style="display: table-row;"><div contenteditable="true" style="display: table-cell; min-width: 100%; vertical-align: middle; font-size: 20px; color: #666666; padding-left: 40px; background-image: url(./img/topic.png); background-size: 30px 30px; background-repeat: no-repeat; height: 30px;" class="tags"><!--img(src="./img/topic.png", width="30", height="30", style="padding: 0px 8px 0px 0px; margin: 0px; vertical-align: middle;")-->&nbsp;</div><div style="width: 150px; display: table-cell; text-align: left;" class="options">&nbsp;</div></div></div></div><div style="position: absolute; width: 100%; bottom: -50px; z-index: -1000;" class="timeline-branch"><div style="display: table; width: 100%;"><div style="display: table-row;"><div style="display: table-cell; min-width: 100px; height: 100px; background-image: url('./img/timeline-branch-right.png'); background-repeat: no-repeat;"></div> <div style="display: table-cell; background-image: url('./img/timeline-line-horizontal.png'); background-repeat: repeat-x; width: 100%;"></div> <div style="position: relative; display: table-cell; min-width: 100px; background-image: url('./img/timeline-line-horizontal.png'); background-repeat: no-repeat;" class="timeline"><!--div(style="position: absolute; width: 30px; height: 30px; background-color: red; bottom: 60px; right: 10px; -webkit-transform: rotate(20deg); border-radius: 8px;")--><!--|--></div></div></div></div></div></div></div></li><li id="topic-activity-template" data-activity-type="topic" data-id="" data-timeline="" class="activity-template"><div style="display: table; width: 100%;"><div style="display: table-row;"><div style="display: table-cell; text-align: center; vertical-align: middle;"><img src="./img/topic.png" width="50" height="50" style="padding: 10px;"></div><div style="display: table-cell; position: relative; z-index: 0; width: 100%; border-left: 2px solid #00a14b;"><div class="activity-widget"><div style="display: table; width: 100%;" class="element-table"><!-- Core activity--><div style="display: table-row;" class="element"><div style="display: table-cell; vertical-align: middle;" contenteditable="true" class="text">&nbsp;</div><div style="width: 120px; display: table-cell; text-align: right; vertical-align: top;" class="options"><!--img(class="open", src="./img/open.png")--><img src="./img/cross-gray.png" class="hide"></div></div></div></div><div style="position: absolute; width: 100%; top: 43px; z-index: -1000;" class="timeline-branch"><div style="display: table; width: 100%;"><div style="display: table-row;"><div style="display: table-cell; min-width: 100px; height: 100px; background-image: url('./img/timeline-branch-right-green.png'); background-repeat: no-repeat;"></div> <div style="display: table-cell; background-image: url('./img/timeline-line-horizontal-green.png'); background-repeat: repeat-x; width: 100%;"></div> <div style="position: relative; display: table-cell; min-width: 100px; background-image: url('./img/timeline-line-horizontal-green.png'); background-repeat: no-repeat;" class="timeline"><!--div(style="position: absolute; width: 30px; height: 30px; background-color: red; bottom: 60px; right: 10px; -webkit-transform: rotate(20deg); border-radius: 8px;")--><!--|--></div></div></div></div></div></div></div></li><li id="photo-template" data-activity-type="photo" data-id="" data-timeline="" class="activity-template"><div style="display: table; width: 100%;"><div style="display: table-row;"><div style="display: table-cell; text-align: center; vertical-align: middle;"><img src="./img/blank.png" width="50" height="0" style="padding: 10px;"></div><div style="display: table-cell; position: relative; z-index: 0; width: 100%; border-left: 2px solid #f16521; vertical-align: middle; padding-left: 22px; padding-top: 40px; font-size: 20px; color: #666666;" class="account">&nbsp;</div></div><div style="display: table-row;"><div style="display: table-cell; text-align: center; vertical-align: middle;"><img src="./img/camera.png" width="50" height="50" style="padding: 10px;"></div><div style="display: table-cell; position: relative; z-index: 0; width: 100%; border-left: 2px solid #7e3f98;"><div class="activity-widget"><div style="display: table; width: 100%;" class="element-table"><!-- Core activity--><div style="display: table-row;" class="element"><img src="./img/camera.png" width="250" height="250" class="image"><div style="width: 120px; display: table-cell; text-align: right; vertical-align: top;" class="options"><!--img(class="open", src="./img/open.png")--><img src="./img/cross-gray.png" class="hide"></div></div><!-- Divider--><div style="display: table-row;"><div style="display: table-cell;" class="divider"><hr style="margin-bottom: 8px; height: 1px; border: none; background-color: #dddddd;"></div><div style="display: table-cell;" class="divider"><hr style="margin-bottom: 8px; height: 1px; border: none; background-color: #dddddd;"></div></div><!-- Tags--><div style="display: table-row;"><div contenteditable="true" style="display: table-cell; min-width: 100%; vertical-align: middle; font-size: 20px; color: #666666; padding-left: 40px; background-image: url(./img/topic.png); background-size: 30px 30px; background-repeat: no-repeat; height: 30px;" class="tags"><!--img(src="./img/topic.png", width="30", height="30", style="padding: 0px 8px 0px 0px; margin: 0px; vertical-align: middle;")-->&nbsp;</div><div style="width: 150px; display: table-cell; text-align: left;" class="options">&nbsp;</div></div></div></div><div style="position: absolute; width: 100%; bottom: -50px; z-index: -1000;" class="timeline-branch"><div style="display: table; width: 100%;"><div style="display: table-row;"><div style="display: table-cell; min-width: 100px; height: 100px; background-image: url('./img/timeline-branch-right-purple.png'); background-repeat: no-repeat;"></div> <div style="display: table-cell; background-image: url('./img/timeline-line-horizontal-purple.png'); background-repeat: repeat-x; width: 100%;"></div> <div style="position: relative; display: table-cell; min-width: 100px; background-image: url('./img/timeline-line-horizontal-purple.png'); background-repeat: no-repeat;" class="timeline"><!--div(style="position: absolute; width: 30px; height: 30px; background-color: red; bottom: 60px; right: 10px; -webkit-transform: rotate(20deg); border-radius: 8px;")--><!--|--></div></div></div></div></div></div></div></li><li id="video-activity-template" data-activity-type="video" data-id="" data-timeline="" class="activity-template"><div style="display: table; width: 100%;"><div style="display: table-row;"><div style="display: table-cell; text-align: center; vertical-align: middle;"><img src="./img/blank.png" width="50" height="0" style="padding: 10px;"></div><div style="display: table-cell; position: relative; z-index: 0; width: 100%; border-left: 2px solid #f16521; vertical-align: middle; padding-left: 22px; padding-top: 40px; font-size: 20px; color: #666666;" class="account">&nbsp;</div></div><div style="display: table-row;"><div style="display: table-cell; text-align: center; vertical-align: middle;"><img src="./img/video.png" width="50" height="50" style="padding: 10px;"></div><div style="display: table-cell; position: relative; z-index: 0; width: 100%; border-left: 2px solid #ed1c24;"><div class="activity-widget"><div style="display: table; width: 100%;" class="element-table"><!-- Core activity--><div style="display: table-row;" class="element"><video width="320" height="240" controls class="video"><source src="" class="source"></video><div style="width: 120px; display: table-cell; text-align: right; vertical-align: top;" class="options"><!--img(class="open", src="./img/open.png")--><img src="./img/cross-gray.png" class="hide"></div></div><!-- Divider--><div style="display: table-row;"><div style="display: table-cell;" class="divider"><hr style="margin-bottom: 8px; height: 1px; border: none; background-color: #dddddd;"></div><div style="display: table-cell;" class="divider"><hr style="margin-bottom: 8px; height: 1px; border: none; background-color: #dddddd;"></div></div><!-- Tags--><div style="display: table-row;"><div contenteditable="true" style="display: table-cell; min-width: 100%; vertical-align: middle; font-size: 20px; color: #666666; padding-left: 40px; background-image: url(./img/topic.png); background-size: 30px 30px; background-repeat: no-repeat; height: 30px;" class="tags"><!--img(src="./img/topic.png", width="30", height="30", style="padding: 0px 8px 0px 0px; margin: 0px; vertical-align: middle;")-->&nbsp;</div><div style="width: 150px; display: table-cell; text-align: left;" class="options">&nbsp;</div></div></div></div><div style="position: absolute; width: 100%; bottom: -50px; z-index: -1000;" class="timeline-branch"><div style="display: table; width: 100%;"><div style="display: table-row;"><div style="display: table-cell; min-width: 100px; height: 100px; background-image: url('./img/timeline-branch-right-red.png'); background-repeat: no-repeat;"></div> <div style="display: table-cell; background-image: url('./img/timeline-line-horizontal-red.png'); background-repeat: repeat-x; width: 100%;"></div> <div style="position: relative; display: table-cell; min-width: 100px; background-image: url('./img/timeline-line-horizontal-red.png'); background-repeat: no-repeat;" class="timeline"><!--div(style="position: absolute; width: 30px; height: 30px; background-color: red; bottom: 60px; right: 10px; -webkit-transform: rotate(20deg); border-radius: 8px;")--><!--|--></div></div></div></div></div></div></div></li></ul></div><!----><!-- Top of interface--><!----><div style="display: table; width: 100%; margin: 0px; margin-top: 20px; padding: 0px;"><!----><!-- Link to "previous timeline" (if any)--><!----><div style="display: table-row;" id="previous-timeline-widget"><div style="display: table-cell; text-align: center; vertical-align: middle; width: 70px; background-image: url(./img/timeline-edge-to-previous.png); background-repeat: no-repeat; background-position: right bottom;"><img src="./img/blank.png" width="72" height="50" style="padding: 0px;"></div><div style="display: table-cell; width: 100%; padding-left: 10px;"><p style="font-size: 40px; margin-top: 40px; color: #bbbbbb; margin-bottom: 35px;"><a href="javascript:void(0);" class="link">go back</a></p></div></div><!----><!-- ScienceKit logo (shown on "default" timeline)--><!----><div style="display: table-row;" id="sciencekit-logo"><div style="display: table-cell; text-align: center; vertical-align: middle; width: 30px;"><img src="./img/blank.png" width="50" height="50" style="padding: 10px;"></div><div style="display: table-cell; width: 100%; border-left: 2px solid #f16521; padding-left: 10px;"><img id="logo" src="./img/sciencekit-logo.png" alt="sciencekit logo" style="margin-top: 50px;"></div></div><!----><!-- Timeline introductory text (e.g., "once upon a time")--><!----><div style="display: table-row;" id="timeline-intro-text"><div style="display: table-cell; text-align: center; vertical-align: middle; width: 30px;"><img src="./img/blank.png" width="30" height="30" style="padding: 10px;"></div><div style="display: table-cell; width: 100%; border-left: 2px solid #f16521; padding-left: 10px;"><p id="beginning" class="tagline">once upon a time</p></div></div></div><!----><!-- Timeline interface--><!----><ul id="narrative-list"></ul><div id="bottom" style="text-align: right; font-size: 30px; padding-right: 10px;" class="edge"><a href="javscript:void(0);" onclick="scrollToBottom();"> <img src="./img/down-arrow.png" alt="bottom" style="position: absolute; bottom: 0px; right: 0px;"></a></div><div id="footer" class="float-action"><div class="float-action-edge"><a href="javscript:void(0);" onclick="scrollToBottom();"> <img src="./img/down-arrow.png" alt="bottom" style="position: absolute; bottom: 0px; right: 0px;"></a></div><div class="float-action-body"><img src="./img/thought.png" width="50" height="50"><img src="./img/camera.png" width="50" height="50"><img src="./img/video.png" width="50" height="50"><!--img(src="./img/topic.png", width="50", height="50")--></div></div><!----><!-- Bottom of interface--><!----><div style="display: table; width: 100%; margin: 0px; margin-bottom: 80px; padding: 0px;"><div style="display: table-row;"><div style="display: table-cell; text-align: center; vertical-align: middle; width: 30px;"><img src="./img/blank.png" width="50" height="50" style="padding: 10px;"></div><div style="display: table-cell; width: 100%; padding-left: 10px; padding-top: 20px;"><p class="tagline">ahoy there... what do you want to do?</p></div></div><div style="display: table-row;"><div style="display: table-cell; text-align: center; vertical-align: middle; width: 50px;"><div id="avatar-container" style="border-radius: 8px; background-image: url('./img/blank.png'); background-size: 50px 50px; margin: 10px; width: 50px; height: 50px;"></div><!--img(id="kit-avatar", src="./img/blank.png", width="50", height="50", style="padding: 10px; border-radius: 8px;")--></div><div style="display: table-cell; width: 100%; padding-left: 10px;"><div style="display: table;"><div style="display: table-row;"><div style="display: table-cell;"><div style="background-image: url(./img/thought.png); background-repeat:no-repeat; background-position:3px 0px; height: 70px; width: 110px; padding-left: 118px; padding-top: 34px; font-size: 30px;"><a id="create-thought-button" data-artifact-type="thought" href="javascript:void(0);" onclick="addThoughtWidget();">thought</a></div></div><!--div(style="display: table-cell;")--><!--	mixin option('topic', 'topic', './img/topic.png', 'addTopicWidget();')--><div style="display: table-cell;"><div style="background-image: url(./img/video.png); background-repeat:no-repeat; background-position:3px 0px; height: 70px; width: 110px; padding-left: 118px; padding-top: 34px; font-size: 30px;"><a id="create-video-button" data-artifact-type="video" href="javascript:void(0);" onclick="captureVideo2();">video</a></div></div><div style="display: table-cell;"><div style="background-image: url(./img/camera.png); background-repeat:no-repeat; background-position:3px 0px; height: 70px; width: 110px; padding-left: 118px; padding-top: 34px; font-size: 30px;"><a id="create-photo-button" data-artifact-type="photo" href="javascript:void(0);" onclick="capturePhotoToURI();">photo</a></div></div></div></div><!--mixin option('avatar', 'avatar', './img/camera.png', 'captureAvatarToURI();')--><!-- question--><!-- cause and effect--><!-- step by step--><!-- note--><!-- voice--><!-- collage--><!-- measurement--><!-- tag--><!-- time--><!-- compass--><!-- vibration--><!-- madlib--><!-- 5x chat--></div></div></div><!----><!-- "Storybook" interface--><!----><div id="float-page" class="float-page"><div class="float-page-table"><p class="float-page-p">once upon a time</p></div></div><script>window.onload = function() {

 //localStorage['host'] = 'http://10.109.95.23:3000';
 
 // Initialize web socket connection for real-time collaboration
 connectWebSocket();
 
 // Define interaction event listeners
 
 // Initialize GUI event listeners
 $('#outgoingChatMessage').keypress(function(event) {
  if(event.which == 13) {
   event.preventDefault();
   
   // var oauthAccessToken = $('#token_response').text(); // Get access token
   var oauthAccessToken = localStorage['token'];
   var messageText = $('#outgoingChatMessage').val();
   var message = JSON.stringify({ 'token': oauthAccessToken, 'message': messageText });
   
   console.log('Sending message: ' + message);
   socketio.send(message);
   $('#incomingChatMessages').append($('<li></li>').text($('#outgoingChatMessage').val()));
   $('#outgoingChatMessage').val('');
  }
 });
 
 
 
 
 
 
 // Initialize interface
 $('#float-page').hide();
 
 $('#previous-timeline-widget').hide();
 
 // Populate timeline
 getTimeline();
 
 // Add handler for interrupting automatic scrolling
 $('body,html').bind("scroll mousedown DOMMouseScroll mousewheel keyup", function(e) {
  if ( e.which > 0 || e.type === "mousedown" || e.type === "mousewheel") {
   console.log('Canceling autoscrolling animation.');
   clearTimeout($.data(document, 'timer'));
   $("html,body").stop();
  }
 });
 
 // Set time to scroll to bottom
 /*
 $.data(document, 'timer', setTimeout(function() {
  scrollToBottom();
 }, 2000));
 */
 
 // Get Account
 getAvatar();
 
 //scrollToBottom();
 
 // orientationchange
 
 // gesturestart
 
 // gesturechange
 
 // gestureend
}

// Show options when scroll up, hide when scroll down
var prevPosition = 0;
window.onscroll = function() {
 // console.log("scroll event detected! " + window.pageXOffset + " " + window.pageYOffset);
 
 var currPosition = window.pageYOffset;
 var delta = currPosition - prevPosition;
 prevPosition = currPosition;
 //console.log(delta);
 
 // Show or hide bottom shortcuts
 if(delta > 10) {
  $("#footer").slideUp();
 } else if (delta < -10) {
  $("#footer").slideDown();
 }
 
 // Update widget with focus (closest to center)
 /*
 var closestWidget = null;
 var closestDistance = -1;
 var timelineList = $('#narrative-list li').get();
 for(var i = 0; i < timelineList.length; i++) {
  $(timelineList[i]).find('.element .options').css('visibility', 'hidden');
  
  var widgetTop = Math.abs($(timelineList[i]).position().top - (currPosition + window.innerHeight / 2));
  if (closestDistance == -1 || (widgetTop < closestDistance)) {
   closestWidget = $(timelineList[i]);
   closestDistance = widgetTop;
  }
 }
 console.log('Widget with focus: ' + $(closestWidget).attr('id'));
 $(closestWidget).find('.element .options').css('visibility', 'visible');
 */
}

// Scroll to element

function generateStory() {
 // TODO: Take into account voting!
 
 // Show the introduction
 $('#float-page').fadeIn().delay(2000).fadeOut();
 
 // Generate list of "pages" to include in story
 var timelineList = $('#narrative-list li').get();
 var timelineHighlights = [ 0, 13, 19, 37, 55, 68 ];
 
 // Scroll through the pages
 $("html,body").stop().delay(1000);
 for(var i = 0; i < 6; i++) {
  $('html,body').animate({ scrollTop: $(timelineList[(timelineHighlights[i])]).offset().top }, 1000).delay(1000);
 }
 
 // Scroll to "end point" of story
 //$('html,body').animate({ scrollTop: $('#sciencekit-small-logo').offset().top }, 1000);
 $('html,body').animate({ scrollTop: document.body.scrollHeight }, 1000);
}

function generatePage() {
 // Show full-screen
 // Show controls for "next" and "previous" page
 // Let interact with page/timeline
}


function scrollToTop() {
 $('html,body').animate({ scrollTop: 0 }, 1000);
}

function scrollToBottom() {
 //$('html,body').animate({ scrollTop: $('#sciencekit-small-logo').offset().top }, 1000);
 //$('html,body').animate({ scrollTop: document.body.scrollHeight }, 1000);
 $('html,body').animate({ scrollTop: document.body.clientHeight }, 1000);
}

function scrollTickle() {
 var range = 70;
 var ms = 110;
 var iterations = 2;
 var position = $(window).scrollTop();
 for(var i = 0; i < iterations; i++) {
  $('html,body').animate({ scrollTop: position + range }, ms);
  $('html,body').animate({ scrollTop: position - range }, ms);
 }
 $('html,body').animate({ scrollTop: position }, ms);
 return false;
}

// x = 0;  //horizontal coord
// y = document.height; //vertical coord
// window.scroll(x,y);
//$('#beginning').hide();
//$('#beginning').fadeIn(3000);


// Wire up interface
$('#create-thought-button').click(function() {

 // Add question to list immediately
 //var e = addThoughtWidget();
 
 //return false;
});

$('#create-topic-button').click(function() {
 //var e = addTopicWidget();
 //return false;
});

$('#create-question-button').click(function() {
 return false;
});

$('#create-cause-and-effect-button').click(function() {
 return false;
});

$('#create-step-by-step-button').click(function() {

 // Add question to list immediately
 addStepByStep({});
 
 return false;
});

$('#create-note-button').click(function() {

 // Add question to list immediately
 addNote({});
 
 return false;
});</script></body></html>